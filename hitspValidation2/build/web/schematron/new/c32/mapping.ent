<!--  Mapping HITSP C32 Modules to their IHE counterparts  -->

<!-- errors -->

  <pattern id="p-mapping-errors">
    <title>C32/IHE Mapping - errors validation phase</title>
    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.12"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.13.7"'>
          Error: C83-[223] An advance directive data element SHALL declare conformance 
          to the IHE Advance Directive Observation by
          including a &lt;templateId&gt; element with the root attribute set to the value
          1.3.6.1.4.1.19376.1.5.3.1.4.13.7.
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.10.20.1.2"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.3.13"'>
         Error: C83-[15] An Allergies and Other Adverse Reactions Section SHALL conform 
         to the IHE Allergies and Other Adverse Reactions Section template, and SHALL contain a
         templateId element whose root attribute is 1.3.6.1.4.1.19376.1.5.3.1.3.13.
       </assert>

       <assert test='.//cda:templateId/@root="2.16.840.1.113883.3.88.11.83.6"'>
         Error: C83-[14] An Allergies and Other Adverse Reactions Section SHALL include
         entries from the Allergy/Drug Sensitivity module (2.16.840.1.113883.3.88.11.83.6). 
       </assert>


    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.6"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.5.3"'>
          Error: C83-[143] All allergy entries SHALL conform to the IHE PCC Allergy and 
          Intolerance Concern template by including a
          &lt;templateId&gt; element with the root attribute set to the value 1.3.6.1.4.1.19376.1.5.3.1.4.5.3
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.11"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.2"'>
          Error: C83-[220] Each comment module SHALL be conformant with the IHE Comment 
          module and SHALL include a
          &lt;templateID&gt; element with the root attribute set to the value 1.3.6.1.4.1.19376.1.5.3.1.4.2
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.10.20.1.11"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.3.6"'>
       Error: C83-[17] The Problem List section SHALL conform to the IHE Active 
         Problems Section template, and SHALL contain a templateId element whose
         root attribute is 1.3.6.1.4.1.19376.1.5.3.1.3.6.
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.7"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.5.2"'>
       Error: C83-[151] Problem Entries SHALL also declare conformance to the 
          IHE Problem Concern by including a
          &lt;templateId&gt; element with the root attribute set to the value 1.3.6.1.4.1.19376.1.5.3.1.4.5.2
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.10.20.1.3"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.1.5.3.3"'>
       Error: C83-[68] The Encounters section SHALL conform to the IHE Encounters History
          section, and SHALL contain a templateId element whose root
          attribute is 1.3.6.1.4.1.19376.1.5.3.1.1.5.3.3.
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.16"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.14"'>
          Error: C83-[249] Encounter data elements SHALL declare conformance to the 
          IHE Encounter entry by including a
          &lt;templateId&gt; element with the root attribute set to the value 1.3.6.1.4.1.19376.1.5.3.1.4.14
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.4"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.2.3"'>
          Error: C83-[115] All healthcare providers modules SHALL declare conformance 
          to the IHE Healthcare Providers and
          Pharmacies specification by including a &lt;templateID&gt; element with the root attribute set to the value
          1.3.6.1.4.1.19376.1.5.3.1.2.3
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.10.20.1.6"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.3.23"'>
         Error: C83-[46] The Immunizations section SHALL conform to the IHE Immunizations 
         section, and SHALL contain a templateId element whose root attribute
         is 1.3.6.1.4.1.19376.1.5.3.1.3.23.
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.13"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.12"'>
          Error: C83-[238] Immunization data elements SHALL declare conformance to the IHE 
          Immunization entry by including a
          &lt;templateId&gt; element with the root attribute set to the value 1.3.6.1.4.1.19376.1.5.3.1.4.12
       </assert>
    </rule>

<!-- No mapping for Information Source -->

<!-- Have to use CCD link for Payer -->

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.10.20.1.9"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.1.5.3.7"'>
         Error: C83-[12] The Payer section SHALL conform to the IHE Payers Section
         template, and SHALL contain a templateId element whose root
         attribute is 1.3.6.1.4.1.19376.1.5.3.1.1.5.3.7
       </assert>
    </rule>

<!--
This is incorrect.  The template ID for IHE Coverage Entry is 1.3.6.1.4.1.19376.1.5.3.1.4.17.  The listed template ID is for Payers Section, which is a section, not an entry.  Not running this check for now.

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.5"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.1.5.3.7"'>
          Error: C83-[119] All Insurance Provider modules SHALL declare conformance 
          to the IHE Coverage Entry by including a
          &lt;templateID&gt; element with the root attribute set to the value 1.3.6.1.4.1.19376.1.5.3.1.1.5.3.7
       </assert>
    </rule>
-->


    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.2"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.2.1"'>
          Error: C83-[106] All Language Spoken modules SHALL declare conformance to 
          the IHE Language Communication module by
          including a &lt;templateID&gt; element with the root attribute set to the 
          value 1.3.6.1.4.1.19376.1.5.3.1.2.1
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.8"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.7"'>
          Error: C83-[158] Substance Administration acts conforming to this module 
          SHALL also declare conformance to the IHE
          Medications entity by including a &lt;templateId&gt; element with the root 
          attribute set to the value
          1.3.6.1.4.1.19376.1.5.3.1.4.7
       </assert>
    </rule>

<!-- Person Information has no mapping to IHE. -->

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.10.20.1.8"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.3.19"'>
          Error: C83-[36] The Medications section SHALL conform to the IHE Medications 
          section, and SHALL contain a templateId element whose root attribute is
          1.3.6.1.4.1.19376.1.5.3.1.3.19.
       </assert>
       <assert test='.//cda:templateId/@root="2.16.840.1.113883.3.88.11.83.8"'>
          Error: C83-[37] The Medications section SHALL include entries from the 
          Medication module to provide the relevant medications in coded form.
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.8"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.7"'>
          Error: C83-[158] Substance Administration acts conforming to this module 
          SHALL also declare conformance to the IHE
          Medications entity by including a &lt;templateId&gt; element with the root attribute set to the value
          1.3.6.1.4.1.19376.1.5.3.1.4.7
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.8.2"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.7.2"'>
          Error: C83-[171] Medication Information data elements SHALL declare conformance 
          to the IHE Product Entry template by
          including a &lt;templateId&gt; element with the root attribute set to the value
          1.3.6.1.4.1.19376.1.5.3.1.4.7.2
       </assert>
    </rule>


    <rule context='*[cda:templateId/@root="2.16.840.1.113883.10.20.1.49"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.3"'>
          Error: C83-[189] Medication Information data elements SHALL declare conformance 
          to the IHE Patient Medication Instructions
          template by including a &lt;templateID&gt; element with the root attribute set to the value
          1.3.6.1.4.1.19376.1.5.3.1.4.3
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.8.3"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.7.3"'>
          Error: C83-[197] Order Information data elements SHALL declare conformance to the IHE Supply Entry template by
          including a &lt;templateId&gt; element with the root attribute set to the value
          1.3.6.1.4.1.19376.1.5.3.1.4.7.3
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.10.20.1.43"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.3.1"'>
          Error: C83-[203] Fulfillment instructions data elements SHALL declare conformance to 
          the IHE Medication Fulfillment
          Instructions template by including a &lt;templateID&gt; element with the root attribute set to the value
          1.3.6.1.4.1.19376.1.5.3.1.4.3.1
       </assert>
    </rule>


    <rule context='*[cda:templateId/@root="2.16.840.1.113883.10.20.1.10"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.3.31"'>
         Error: C83-[60] The Plan of Care section SHALL conform to the IHE Care Plan section, 
         and SHALL contain a templateId element whose root attribute is
         1.3.6.1.4.1.19376.1.5.3.1.3.31.
       </assert>
       <assert test='cda:templateId/@root="2.16.840.1.113883.10.20.2.7"'>
         Error: C83-[61] The Plan of Care section SHALL conform to the HL7 History and Physical 
         Note and HL7 Consultation Note requirements for this section, and
         SHALL contain a templateId element whose root attribute is 2.16.840.1.113883.10.20.2.7
       </assert>
    </rule>


<!-- No mapping for Pregnancy Module -->


    <rule context='*[cda:templateId/@root="2.16.840.1.113883.10.20.1.12"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.3.12"'>
         Error: C83-[29] The List of Surgeries section SHALL conform to the IHE Coded 
         List of Surgeries template, and SHALL contain a templateId element whose
         root attribute is 1.3.6.1.4.1.19376.1.5.3.1.3.12
       </assert>
       <assert test='.//cda:templateId/@root="2.16.840.1.113883.3.88.11.83.17"'>
         Error: C83-[30] The List of Surgeries section SHALL include entries from 
         the Procedure module.
       </assert>
    </rule>

<!-- No mapping for Procedure entry module -->


    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.3"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.2.4"'>
          Error: C83-[111] All support modules SHALL also declare conformance 
          to the IHE Patient Contacts module by including a
          &lt;templateId&gt; element with the root attribute set to the value 1.3.6.1.4.1.19376.1.5.3.1.2.4
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.10.20.1.16"]'>
       <assert test='cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.1.5.3.2"'>
         Error: C83-[50] The Vital Signs section SHALL conform to the IHE Coded Vital Signs 
         section, and SHALL contain a templateId element whose root
         attribute is 1.3.6.1.4.1.19376.1.5.3.1.1.5.3.2.
       </assert>
       <assert test='.//cda:templateId/@root="2.16.840.1.113883.3.88.11.83.14"'>
         Error: C83-[51] The Vital Signs section SHALL contain entries conforming to 
         the Vital Sign module.
       </assert>
    </rule>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.3.88.11.83.14"]'>
       <assert test='ancestor::*/cda:templateId/@root="1.3.6.1.4.1.19376.1.5.3.1.4.13.1"'>
          Error: C83-[242] Vital signs information elements SHALL be contained in 
          a conforming IHE Vital Signs Organizer element that
          includes a &lt;templateID&gt; element with the root attribute set to the value
          1.3.6.1.4.1.19376.1.5.3.1.4.13.1
       </assert>
    </rule>

  </pattern>

  <!-- warning -->

  <pattern id="p-mapping-warning">
    <title>C32/IHE Mapping - warning validation phase</title>
    <rule context='*[cda:templateId/@root="2.16.840.1.113883.10.20.1.9"]'>
       <assert test='.//cda:templateId/@root="2.16.840.1.113883.3.88.11.83.5"'>
          Warning: C83-[13] The Payers section SHALL include entries from the 
          Insurance Provider module when this information is known.
       </assert>

    </rule>

  </pattern>

  <pattern id="p-mapping-notes">
    <title>C32/IHE Mapping - notes validation phase</title>

    <rule context='*[cda:templateId/@root="2.16.840.1.113883.10.20.1.10"]'>
       <assert test='.//cda:templateId/@root="2.16.840.1.113883.3.88.11.83.8"'>
          Note: C83-[62] The Plan of Care section MAY include entries conforming to 
          the Medication module to provide
          information about the intended care plan.
       </assert>
       <assert test='.//cda:templateId/@root="2.16.840.1.113883.3.88.11.83.13"'>
          Note: C83-[62] The Plan of Care section MAY include entries conforming to
          the Immunization module to provide
          information about the intended care plan.
       </assert>
       <assert test='.//cda:templateId/@root="2.16.840.1.113883.3.88.11.83.16"'>
          Note: C83-[62] The Plan of Care section MAY include entries conforming to
          the Encounter module to provide
          information about the intended care plan.
       </assert>
       <assert test='.//cda:templateId/@root="2.16.840.1.113883.3.88.11.83.17"'>
          Note: C83-[62] The Plan of Care section MAY include entries conforming to
          the Procedure module to provide
          information about the intended care plan.
       </assert>


    </rule>
  </pattern>

